<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>AugReality.as</title>
<link rel="stylesheet" type="text/css" href="../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptComment">//imported classes (automatically generated)
</span>    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">BitmapData</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">Sprite</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">media</span>.<span class="ActionScriptDefault_Text">Camera</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">media</span>.<span class="ActionScriptDefault_Text">Video</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">ByteArray</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">FLARCode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">param</span>.<span class="ActionScriptDefault_Text">FLARParam</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">raster</span>.<span class="ActionScriptDefault_Text">rgb</span>.<span class="ActionScriptDefault_Text">FLARRgbRaster_BitmapData</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">transmat</span>.<span class="ActionScriptDefault_Text">FLARTransMatResult</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">detector</span>.<span class="ActionScriptDefault_Text">FLARSingleMarkerDetector</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">pv3d</span>.<span class="ActionScriptDefault_Text">FLARBaseNode</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">pv3d</span>.<span class="ActionScriptDefault_Text">FLARCamera3D</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">lights</span>.<span class="ActionScriptDefault_Text">PointLight3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">objects</span>.<span class="ActionScriptDefault_Text">primitives</span>.<span class="ActionScriptDefault_Text">Cube</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">render</span>.<span class="ActionScriptDefault_Text">BasicRenderEngine</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">scenes</span>.<span class="ActionScriptDefault_Text">Scene3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">Viewport3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">MaterialsList</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">shadematerials</span>.<span class="ActionScriptDefault_Text">FlatShadeMaterial</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">BitmapMaterial</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">BitmapFileMaterial</span>;
    
    <span class="ActionScriptComment">//This SWF command generates the size, framerate and color of the window
</span>    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">SWF</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;640&quot;</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;480&quot;</span>, <span class="ActionScriptDefault_Text">frameRate</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;30&quot;</span>, <span class="ActionScriptDefault_Text">backgroundColor</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;#FFFFFF&quot;</span><span class="ActionScriptBracket/Brace">)]</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">AugReality</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">Sprite</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">//Embed the &quot;marker.pat&quot; template into the project
</span>        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Embed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;marker.pat&quot;</span>, <span class="ActionScriptDefault_Text">mimeType</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;application/octet-stream&quot;</span><span class="ActionScriptBracket/Brace">)]</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">marker</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Class</span>;
        
        <span class="ActionScriptComment">//Embed the &quot;camera_para.dat&quot; webcam data file into the project
</span>        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Embed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;camera_para.dat&quot;</span>, <span class="ActionScriptDefault_Text">mimeType</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;application/octet-stream&quot;</span><span class="ActionScriptBracket/Brace">)]</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cam_params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Class</span>;
        
        <span class="ActionScriptComment">//createFLAR variables
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARParam</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_marker</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARCode</span>;
        <span class="ActionScriptComment">//createCam variables
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_vid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Video</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_cam</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Camera</span>;
        <span class="ActionScriptComment">//createBMP vairiables
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_bmp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_raster</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARRgbRaster_BitmapData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_detection</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARSingleMarkerDetector</span>;
        <span class="ActionScriptComment">//createPapervision variables
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_scene</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Scene3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_3dcam</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARCamera3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_basenode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARBaseNode</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_viewport</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Viewport3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_renderengine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BasicRenderEngine</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_transmat</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARTransMatResult</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_cube</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Cube</span>

        <span class="ActionScriptComment">//This function is automatically generated        
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AugReality</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">void</span> <span class="ActionScriptDefault_Text">createFLAR</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//call the createFlar function
</span>            <span class="ActionScriptReserved">void</span> <span class="ActionScriptDefault_Text">createCam</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//call the createCam function
</span>            <span class="ActionScriptReserved">void</span> <span class="ActionScriptDefault_Text">createBMP</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//call the createBMP function
</span>            <span class="ActionScriptReserved">void</span> <span class="ActionScriptDefault_Text">createPapervision</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//call the createPapervision function
</span>            <span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span>.<span class="ActionScriptDefault_Text">ENTER_FRAME</span>, <span class="ActionScriptDefault_Text">loop</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//call the loop event
</span>        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//This function sets up the FLAR marker file and webcam settings
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createFLAR</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ar_params</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARParam</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//create new paramaters for the project
</span>            <span class="ActionScriptDefault_Text">ar_marker</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARCode</span><span class="ActionScriptBracket/Brace">(</span>16, 16<span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//create a new 16x16 marker for the project
</span>            <span class="ActionScriptDefault_Text">ar_params</span>.<span class="ActionScriptDefault_Text">loadARParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">cam_params</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//loads paramaters for the webcam
</span>            <span class="ActionScriptDefault_Text">ar_marker</span>.<span class="ActionScriptDefault_Text">loadARPatt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">marker</span><span class="ActionScriptBracket/Brace">())</span>;<span class="ActionScriptComment">//loads the marker file template
</span>        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//This function sets up a new camera that will project the images
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createCam</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ar_vid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Video</span><span class="ActionScriptBracket/Brace">(</span>640, 480<span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//video settings match the SWF size (above)
</span>            <span class="ActionScriptDefault_Text">ar_cam</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Camera</span>.<span class="ActionScriptDefault_Text">getCamera</span><span class="ActionScriptBracket/Brace">()</span>; <span class="ActionScriptComment">//make a new project camera
</span>            <span class="ActionScriptDefault_Text">ar_cam</span>.<span class="ActionScriptDefault_Text">setMode</span><span class="ActionScriptBracket/Brace">(</span>640, 480, 30<span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//camera setings match the video and SWF settings
</span>            <span class="ActionScriptDefault_Text">ar_vid</span>.<span class="ActionScriptDefault_Text">attachCamera</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_cam</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//attach the camera to the video
</span>            <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_vid</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//attach the video to the project
</span>        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//This function sets up a new Bitmap canvas
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createBMP</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ar_bmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptBracket/Brace">(</span>640, 480<span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//create a new Bitmap canvas to match the size of the project
</span>            <span class="ActionScriptDefault_Text">ar_bmp</span>.<span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_vid</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//draw the Bitmap canvas onto the video
</span>            <span class="ActionScriptDefault_Text">ar_raster</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARRgbRaster_BitmapData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_bmp</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Rasterize the Bitmap to RGB
</span>            <span class="ActionScriptDefault_Text">ar_detection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARSingleMarkerDetector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_params</span>, <span class="ActionScriptDefault_Text">ar_marker</span>, 80<span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Attach the marker file as the detection point
</span>        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//This function creates a new PaperVision 3D object
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createPapervision</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ar_scene</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Scene3D</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//Create a new scene
</span>            <span class="ActionScriptDefault_Text">ar_3dcam</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARCamera3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_params</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Create a new 3D camera
</span>            <span class="ActionScriptDefault_Text">ar_basenode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARBaseNode</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//Create a new content box
</span>            <span class="ActionScriptDefault_Text">ar_renderengine</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BasicRenderEngine</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//Create a new rendering object
</span>            <span class="ActionScriptDefault_Text">ar_transmat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARTransMatResult</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//Create a new transformation matrix
</span>            <span class="ActionScriptDefault_Text">ar_viewport</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Viewport3D</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//Create a new viewport
</span>            
            <span class="ActionScriptComment">//The code below creates a light that adds shadow to the 3D object
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_light</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">PointLight3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">PointLight3D</span><span class="ActionScriptBracket/Brace">()</span>;<span class="ActionScriptComment">//Create a new light variable
</span>            <span class="ActionScriptDefault_Text">ar_light</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 1000;<span class="ActionScriptComment">//X axis position for the light
</span>            <span class="ActionScriptDefault_Text">ar_light</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 1000;<span class="ActionScriptComment">//Y axis position for the light
</span>            <span class="ActionScriptDefault_Text">ar_light</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span>1000;<span class="ActionScriptComment">//Z axis position for the light
</span>            
            <span class="ActionScriptComment">//The code below attaches an image file to the Papervision object
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ar_bitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapFileMaterial</span>;<span class="ActionScriptComment">//Create a new material file
</span>            <span class="ActionScriptDefault_Text">ar_bitmap</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitmapFileMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;apple.gif&quot;</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Attach an image to the material
</span>            <span class="ActionScriptDefault_Text">ar_bitmap</span>.<span class="ActionScriptDefault_Text">doubleSided</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;<span class="ActionScriptComment">//Cover front and back of planes
</span>            
            <span class="ActionScriptComment">//create a new cube object that is 80x80x80 pixels
</span>            <span class="ActionScriptDefault_Text">ar_cube</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Cube</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MaterialsList</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">all</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ar_bitmap</span><span class="ActionScriptBracket/Brace">})</span>, 80, 80, 80<span class="ActionScriptBracket/Brace">)</span>;
                                    
            <span class="ActionScriptDefault_Text">ar_scene</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_basenode</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//add the content box to the scene
</span>            <span class="ActionScriptDefault_Text">ar_basenode</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_cube</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">// add the cube to the content box (remove if using a DAE)
</span>            <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_viewport</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Add the viewport to the project
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//This loop tells the project what to do when the video loads
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">loop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ar_bmp</span>.<span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_vid</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//attach the bitmap to the webcam video
</span>            <span class="ActionScriptDefault_Text">ar_cube</span>.<span class="ActionScriptDefault_Text">rotationX</span> <span class="ActionScriptOperator">+=</span>4;<span class="ActionScriptComment">//rotate the cube 4 pixels per frame on the X axis
</span>            <span class="ActionScriptDefault_Text">ar_cube</span>.<span class="ActionScriptDefault_Text">rotationY</span> <span class="ActionScriptOperator">+=</span>6;<span class="ActionScriptComment">//rotate the cube 6 pixels per frame on the Y axis
</span>            
            <span class="ActionScriptReserved">try</span> <span class="ActionScriptComment">//This &quot;try&quot; clause catches any errors and prevents them from locking up the program.
</span>            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//The below code detects the marker &quot;if&quot; it is in the viewing area
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_detection</span>.<span class="ActionScriptDefault_Text">detectMarkerLite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_raster</span>, 80<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">ar_detection</span>.<span class="ActionScriptDefault_Text">getConfidence</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">&gt;</span> 0.5<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">ar_detection</span>.<span class="ActionScriptDefault_Text">getTransformMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_transmat</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//When the marker is found, get the transformation matrix
</span>                    <span class="ActionScriptDefault_Text">ar_basenode</span>.<span class="ActionScriptDefault_Text">setTransformMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_transmat</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Place the content box onto the transformatin matrix
</span>                    <span class="ActionScriptDefault_Text">ar_renderengine</span>.<span class="ActionScriptDefault_Text">renderScene</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar_scene</span>, <span class="ActionScriptDefault_Text">ar_3dcam</span>, <span class="ActionScriptDefault_Text">ar_viewport</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//Render the scene
</span>                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">catch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">){}</span><span class="ActionScriptComment">//catch any errors
</span>        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
