<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>FLARVectorReader_Basic.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/* 
 * PROJECT: FLARToolKit
 * --------------------------------------------------------------------------------
 * This work is based on the FLARToolKit developed by
 *   R.Iizuka (nyatla)
 * http://nyatla.jp/nyatoolkit/
 *
 * The FLARToolKit is ActionScript 3.0 version ARToolkit class library.
 * Copyright (C)2008 Saqoosha
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 * 
 * For further information please contact.
 *    http://www.libspark.org/wiki/saqoosha/FLARToolKit
 *    &lt;saq(at)saqoosha.net&gt;
 * 
 */</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">rpf</span>.<span class="ActionScriptDefault_Text">tracker</span>.<span class="ActionScriptDefault_Text">nyartk</span>
<span class="ActionScriptBracket/Brace">{</span>

    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">param</span>.<span class="ActionScriptDefault_Text">FLARCameraDistortionFactor</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">raster</span>.<span class="ActionScriptDefault_Text">FLARGrayscaleRaster</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">squaredetect</span>.<span class="ActionScriptDefault_Text">FLARContourPickup</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">types</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">FLARMath</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">libspark</span>.<span class="ActionScriptDefault_Text">flartoolkit</span>.<span class="ActionScriptDefault_Text">rpf</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;

    <span class="ActionScriptASDoc">/**
     * IFLARVectorReaderの画素アクセス関数以外を実装したクラスです。
     * 継承クラスで画素アクセス関数を実装してください。
     *
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">FLARVectorReader_Basic</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">IFLARVectorReader</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tmp_coord_pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span><span class="ActionScriptOperator">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_rob_resolution</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ref_base_raster</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARGrayscaleRaster</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ref_rob_raster</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARGrayscaleRaster</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_factor</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARCameraDistortionFactor</span>;
        <span class="ActionScriptASDoc">/**
         * 
         * @param i_ref_raster
         * 基本画像
         * @param i_ref_raster_distortion
         * 歪み解除オブジェクト(nullの場合歪み解除を省略)
         * @param i_ref_rob_raster
         * エッジ探索用のROB画像
         * @param 
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">FLARVectorReader_Basic</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_ref_raster</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARGrayscaleRaster</span>,<span class="ActionScriptDefault_Text">i_ref_raster_distortion</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARCameraDistortionFactor</span>,<span class="ActionScriptDefault_Text">i_ref_rob_raster</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARGrayscaleRaster</span>,<span class="ActionScriptDefault_Text">i_contur_pickup</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARContourPickup</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_rob_resolution</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_ref_raster</span>.<span class="ActionScriptDefault_Text">getWidth</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">i_ref_rob_raster</span>.<span class="ActionScriptDefault_Text">getWidth</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_ref_rob_raster</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_ref_rob_raster</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_ref_base_raster</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_ref_raster</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_coord_buf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARIntCoordinates</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">i_ref_raster</span>.<span class="ActionScriptDefault_Text">getWidth</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_ref_raster</span>.<span class="ActionScriptDefault_Text">getHeight</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_factor</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_ref_raster_distortion</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_tmp_coord_pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span>.<span class="ActionScriptDefault_Text">createArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_coord_buf</span>.<span class="ActionScriptDefault_Text">items</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_cpickup</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_contur_pickup</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getAreaVector33</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">iw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">ih</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">o_posvec</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARVecLinear2d</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Override
</span>            <span class="ActionScriptDefault_Text">FLARException</span>.<span class="ActionScriptDefault_Text">notImplement</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getAreaVector22</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">iy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">iw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">ih</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">o_posvec</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARVecLinear2d</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Override
</span>            <span class="ActionScriptDefault_Text">FLARException</span>.<span class="ActionScriptDefault_Text">notImplement</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * ワーク変数
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_coord_buf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntCoordinates</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span>  <span class="ActionScriptDefault_Text">_cpickup</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARContourPickup</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">_MARGE_ANG_TH</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FLARMath</span>.<span class="ActionScriptDefault_Text">COS_DEG_10</span>;

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">traceConture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_th</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,
                <span class="ActionScriptDefault_Text">i_entry</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntPoint2d</span>,<span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinates</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntCoordinates</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_coord_buf</span>;
            <span class="ActionScriptComment">// Robertsラスタから輪郭抽出
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_cpickup</span>.<span class="ActionScriptDefault_Text">getContour</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_ref_rob_raster</span>, <span class="ActionScriptDefault_Text">i_th</span>, <span class="ActionScriptDefault_Text">i_entry</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">i_entry</span>.<span class="ActionScriptDefault_Text">y</span>,<span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// 輪郭線MAXならなにもできないね。
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;

            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// 輪郭線のベクトル化
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">traceConture_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coord</span>, <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_rob_resolution</span>,
                    <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_rob_resolution</span> <span class="ActionScriptOperator">*</span> 2, <span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>



        <span class="ActionScriptASDoc">/**
         * 点1と点2の間に線分を定義して、その線分上のベクトルを得ます。点は、画像の内側でなければなりません。 320*240の場合、(x&gt;=0 &amp;&amp;
         * x&lt;320 x+w&gt;0 &amp;&amp; x+w&lt;320),(y&gt;0 &amp;&amp; y&lt;240 y+h&gt;=0 &amp;&amp; y+h&lt;=319)となります。
         * 
         * @param i_pos1
         *            点1の座標です。
         * @param i_pos2
         *            点2の座標です。
         * @param i_area
         *            ベクトルを検出するカーネルサイズです。1の場合(n*2-1)^2のカーネルになります。 点2の座標です。
         * @param o_coord
         *            結果を受け取るオブジェクトです。
         * @return
         * @throws FLARException
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">traceLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntPoint2d</span>,<span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntPoint2d</span>,<span class="ActionScriptDefault_Text">i_edge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> ,<span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinates</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntCoordinates</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_coord_buf</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">base_s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntSize</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_ref_base_raster</span>.<span class="ActionScriptDefault_Text">getSize</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptComment">// (i_area*2)の矩形が範囲内に収まるように線を引く
</span>            <span class="ActionScriptComment">// 移動量
</span>
            <span class="ActionScriptComment">// 点間距離を計算
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dist</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)(</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">sqDist</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptBracket/Brace">)))</span>;
            <span class="ActionScriptComment">// 最低AREA*2以上の大きさが無いなら、ラインのトレースは不可能。
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">&lt;</span> 4<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// dist最大数の決定
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">&gt;</span> 12<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">=</span> 12;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// サンプリングサイズを決定(移動速度とサイズから)
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_edge</span> <span class="ActionScriptOperator">*</span> 2 <span class="ActionScriptOperator">+</span> 1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">base_s</span>.<span class="ActionScriptDefault_Text">w</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">s</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">base_s</span>.<span class="ActionScriptDefault_Text">h</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">s</span>;

            <span class="ActionScriptComment">// 最大14点を定義して、そのうち両端を除いた点を使用する。
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">-</span> 1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dx</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_edge</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dy</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_edge</span>;
                <span class="ActionScriptComment">// limit
</span>                <span class="ActionScriptDefault_Text">coord</span>.<span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 0 <span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">coord</span>.<span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 0 <span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">coord</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">-</span> 2;
            <span class="ActionScriptComment">// 点数は20点程度を得る。
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">traceConture_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coord</span>, 1, <span class="ActionScriptDefault_Text">s</span>, <span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">traceLine_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARDoublePoint2d</span>,<span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARDoublePoint2d</span>,<span class="ActionScriptDefault_Text">i_edge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinates</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntCoordinates</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_coord_buf</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">base_s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntSize</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_ref_base_raster</span>.<span class="ActionScriptDefault_Text">getSize</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptComment">// (i_area*2)の矩形が範囲内に収まるように線を引く
</span>            <span class="ActionScriptComment">// 移動量
</span>
            <span class="ActionScriptComment">// 点間距離を計算
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dist</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)(</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">sqDist</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptBracket/Brace">)))</span>;
            <span class="ActionScriptComment">// 最低AREA*2以上の大きさが無いなら、ラインのトレースは不可能。
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">&lt;</span> 4<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// dist最大数の決定
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">&gt;</span> 12<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">=</span> 12;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// サンプリングサイズを決定(移動速度とサイズから)
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_edge</span> <span class="ActionScriptOperator">*</span> 2 <span class="ActionScriptOperator">+</span> 1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">base_s</span>.<span class="ActionScriptDefault_Text">w</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">s</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">base_s</span>.<span class="ActionScriptDefault_Text">h</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">s</span>;

            <span class="ActionScriptComment">// 最大24点を定義して、そのうち両端の2個を除いた点を使用する。
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">-</span> 1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dx</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_edge</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">dy</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">i_edge</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// limit
</span>                <span class="ActionScriptDefault_Text">coord</span>.<span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 0 <span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">coord</span>.<span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">&lt;</span> 0 <span class="ActionScriptOperator">?</span> 0 <span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">coord</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dist</span> <span class="ActionScriptOperator">-</span> 2;
            <span class="ActionScriptComment">// 点数は10点程度を得る。
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">traceConture_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coord</span>, 1, <span class="ActionScriptDefault_Text">s</span>, <span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//ベクトルの類似度判定式
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">checkVecCos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_current_vec</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span>,<span class="ActionScriptDefault_Text">i_prev_vec</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span>,<span class="ActionScriptDefault_Text">i_ave_dx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>,<span class="ActionScriptDefault_Text">i_ave_dy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_current_vec</span>.<span class="ActionScriptDefault_Text">dx</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_current_vec</span>.<span class="ActionScriptDefault_Text">dy</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">x1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">y1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">y1</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//平均ベクトルとこのベクトルがCOS_DEG_20未満であることを確認(pos_ptr.getAbsVecCos(i_ave_dx,i_ave_dy)&lt;FLARMath.COS_DEG_20 と同じ)
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_ave_dx</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">y1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_ave_dy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">FLARMath</span>.<span class="ActionScriptDefault_Text">COS_DEG_20</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_ave_dx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_ave_dx</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_ave_dy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_ave_dy</span><span class="ActionScriptBracket/Brace">))){</span>
                <span class="ActionScriptComment">//隣接ベクトルとこのベクトルが5度未満であることを確認(pos_ptr.getAbsVecCos(i_prev_vec)&lt;FLARMath.COS_DEG_5と同じ)
</span>                <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_prev_vec</span>.<span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">y1</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_prev_vec</span>.<span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">FLARMath</span>.<span class="ActionScriptDefault_Text">COS_DEG_5</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_prev_vec</span>.<span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_prev_vec</span>.<span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">i_prev_vec</span>.<span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">i_prev_vec</span>.<span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptBracket/Brace">)){</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * 輪郭線を取得します。
         * 取得アルゴリズムは、以下の通りです。
         * 1.輪郭座標(n)の画素周辺の画素ベクトルを取得。
         * 2.輪郭座標(n+1)周辺の画素ベクトルと比較。
         * 3.差分が一定以下なら、座標と強度を保存
         * 4.3点以上の集合になったら、最小二乗法で直線を計算。
         * 5.直線の加重値を個々の画素ベクトルの和として返却。
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">traceConture_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntCoordinates</span>,<span class="ActionScriptDefault_Text">i_pos_mag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">i_cell_size</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> ,<span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">VecLinearCoordinates</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span><span class="ActionScriptOperator">&gt;=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_tmp_coord_pos</span>;
            <span class="ActionScriptComment">// ベクトル化
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">MAX_COORD</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">o_coord</span>.<span class="ActionScriptDefault_Text">items</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i_coordlen</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_coord</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FLARIntPoint2d</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_coord</span>.<span class="ActionScriptDefault_Text">items</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos_ptr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span>;

            <span class="ActionScriptComment">//0個目のライン探索
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">number_of_data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptComment">//0番目のピクセル
</span>            <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">scalar</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">getAreaVector33</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_pos_mag</span>, <span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_pos_mag</span>,<span class="ActionScriptDefault_Text">i_cell_size</span>, <span class="ActionScriptDefault_Text">i_cell_size</span>,<span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//[2]に0を保管
</span>
            <span class="ActionScriptComment">//1点目だけは前方と後方、両方に探索をかける。
</span>            <span class="ActionScriptComment">//前方探索の終点
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coord_last_edge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_coordlen</span>;
            <span class="ActionScriptComment">//後方探索
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ave_dx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">dx</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">dy</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i_coordlen</span><span class="ActionScriptOperator">-</span>1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// ベクトル取得
</span>                <span class="ActionScriptDefault_Text">pos_ptr</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">scalar</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">getAreaVector33</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_pos_mag</span>,<span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_pos_mag</span>, <span class="ActionScriptDefault_Text">i_cell_size</span>, <span class="ActionScriptDefault_Text">i_cell_size</span>,<span class="ActionScriptDefault_Text">pos_ptr</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// 類似度判定
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">checkVecCos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptBracket/Brace">]</span>,<span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>,<span class="ActionScriptDefault_Text">ave_dx</span>,<span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//相関なし-&gt;前方探索へ。
</span>                    <span class="ActionScriptDefault_Text">ave_dx</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dx</span>;
                    <span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dy</span>;
                    <span class="ActionScriptDefault_Text">coord_last_edge</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i</span>;
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//相関あり- 点の蓄積
</span>                    <span class="ActionScriptDefault_Text">ave_dx</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dx</span>;
                    <span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dy</span>;
                    <span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">++</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//前方探索
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">coord_last_edge</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// ベクトル取得
</span>                <span class="ActionScriptDefault_Text">pos_ptr</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">scalar</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">getAreaVector33</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_pos_mag</span>,<span class="ActionScriptDefault_Text">coord</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i_pos_mag</span>, <span class="ActionScriptDefault_Text">i_cell_size</span>, <span class="ActionScriptDefault_Text">i_cell_size</span>,<span class="ActionScriptDefault_Text">pos_ptr</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptBracket/Brace">)</span>;            
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sq</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">){</span>
                    <span class="ActionScriptReserved">continue</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">//if (pos_ptr.getAbsVecCos(pos[sum-1]) &lt; FLARMath.COS_DEG_5 &amp;&amp; pos_ptr.getAbsVecCos(ave_dx,ave_dy)&lt;FLARMath.COS_DEG_20) {
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">checkVecCos</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptBracket/Brace">]</span>,<span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>,<span class="ActionScriptDefault_Text">ave_dx</span>,<span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//相関なし-&gt;新しい要素を作る。
</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">leastSquaresWithNormalize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span>,<span class="ActionScriptDefault_Text">sum</span>,<span class="ActionScriptDefault_Text">o_coord</span>.<span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">number_of_data</span><span class="ActionScriptBracket/Brace">]</span>,<span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">*</span>5<span class="ActionScriptBracket/Brace">))){</span>
                        <span class="ActionScriptDefault_Text">number_of_data</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">ave_dx</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dx</span>;
                    <span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dy</span>;
                    <span class="ActionScriptComment">//獲得した値を0へ移動
</span>                    <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">setValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptBracket/Brace">])</span>;
                    <span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">=</span>0;
                    <span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">=</span>1;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//相関あり- 点の蓄積
</span>                    <span class="ActionScriptDefault_Text">ave_dx</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dx</span>;
                    <span class="ActionScriptDefault_Text">ave_dy</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">pos_ptr</span>.<span class="ActionScriptDefault_Text">dy</span>;                
                    <span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">++</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">// 輪郭中心を出すための計算
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">number_of_data</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">MAX_COORD</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// 輪郭ベクトルバッファの最大を超えたら失敗
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">leastSquaresWithNormalize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span>,<span class="ActionScriptDefault_Text">sum</span>,<span class="ActionScriptDefault_Text">o_coord</span>.<span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">number_of_data</span><span class="ActionScriptBracket/Brace">]</span>,<span class="ActionScriptDefault_Text">sq_sum</span><span class="ActionScriptOperator">/</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">*</span>5<span class="ActionScriptBracket/Brace">))){</span>
                <span class="ActionScriptDefault_Text">number_of_data</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// ベクトル化2:最後尾と先頭の要素が似ていれば連結する。
</span>            <span class="ActionScriptComment">// sq_distの合計を計算
</span>            <span class="ActionScriptDefault_Text">o_coord</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">number_of_data</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * ノイズらしいベクトルを無視しながら最小二乗法でベクトルを統合する関数
         * @param i_points
         * @param i_number_of_data
         * @param o_dest
         * @param i_scale_th
         * @return
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">leastSquaresWithNormalize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_points</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span><span class="ActionScriptOperator">&gt;</span>,<span class="ActionScriptDefault_Text">i_number_of_data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>,<span class="ActionScriptDefault_Text">o_dest</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span>,<span class="ActionScriptDefault_Text">i_scale_th</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sum_xy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">sum_x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">sum_y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">sum_x2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_number_of_data</span><span class="ActionScriptOperator">-</span>1; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;=</span>0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">){</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ptr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinatePoint</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">i_points</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptComment">//規定より小さいスケールは除外なう
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ptr</span>.<span class="ActionScriptDefault_Text">scalar</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">i_scale_th</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">continue</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ptr</span>.<span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">sum_xy</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">xw</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ptr</span>.<span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">sum_x</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">xw</span>;
                <span class="ActionScriptDefault_Text">sum_y</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">ptr</span>.<span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">sum_x2</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">xw</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">xw</span>;
                <span class="ActionScriptDefault_Text">num</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span><span class="ActionScriptOperator">&lt;</span>3<span class="ActionScriptBracket/Brace">){</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">la</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sum_x2</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sum_x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sum_x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sum_xy</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sum_x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sum_y</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sum_x2</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sum_y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sum_xy</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">sum_x</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">la</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sum_x</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">lb</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sum_y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">num</span>;
            <span class="ActionScriptComment">//交点を計算
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">lb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">lb</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">la</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">la</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w1</span> <span class="ActionScriptOperator">==</span> 0.0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>        
            <span class="ActionScriptDefault_Text">o_dest</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">la</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">lc</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">lb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cc</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_dest</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">la</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cc</span> <span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">lb</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">lc</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">w1</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">o_dest</span>.<span class="ActionScriptDefault_Text">dy</span><span class="ActionScriptOperator">=-</span><span class="ActionScriptDefault_Text">lb</span>;
            <span class="ActionScriptDefault_Text">o_dest</span>.<span class="ActionScriptDefault_Text">dx</span><span class="ActionScriptOperator">=-</span><span class="ActionScriptDefault_Text">la</span>;
            <span class="ActionScriptDefault_Text">o_dest</span>.<span class="ActionScriptDefault_Text">scalar</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">num</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>    

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__pt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FLARIntPoint2d</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FLARIntPoint2d</span>.<span class="ActionScriptDefault_Text">createArray</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">__temp_l</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARLinear</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FLARLinear</span><span class="ActionScriptBracket/Brace">()</span>;

        <span class="ActionScriptASDoc">/**
         * クリッピング付きのライントレーサです。
         * 
         * @param i_pos1
         * @param i_pos2
         * @param i_edge
         * @param o_coord
         * @return
         * @throws FLARException
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">traceLineWithClip</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARDoublePoint2d</span>,<span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARDoublePoint2d</span>, <span class="ActionScriptDefault_Text">i_edge</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> , <span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">VecLinearCoordinates</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FLARIntSize</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_ref_base_raster</span>.<span class="ActionScriptDefault_Text">getSize</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">is_p1_inside_area</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>, <span class="ActionScriptDefault_Text">is_p2_inside_area</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">FLARIntPoint2d</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">__pt</span>;
            <span class="ActionScriptComment">// 線分が範囲内にあるかを確認
</span>            <span class="ActionScriptDefault_Text">is_p1_inside_area</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">isInnerPoint_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">is_p2_inside_area</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">isInnerPoint_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// 個数で分岐
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">is_p1_inside_area</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">is_p2_inside_area</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// 2ならクリッピング必要なし。
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">traceLine_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span>, <span class="ActionScriptDefault_Text">i_pos2</span>, <span class="ActionScriptDefault_Text">i_edge</span>, <span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;

            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// 1,0個の場合は、線分を再定義
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">__temp_l</span>.<span class="ActionScriptDefault_Text">makeLinearWithNormalize_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span>, <span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">__temp_l</span>.<span class="ActionScriptDefault_Text">makeSegmentLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">w</span>,<span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">h</span>,<span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">is_p1_inside_area</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">is_p2_inside_area</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// 1ならクリッピング後に、外に出ていた点に近い輪郭交点を得る。
</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">is_p1_inside_area</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// p2が範囲外
</span>                    <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[(</span><span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">sqDist_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">sqDist_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]))</span> <span class="ActionScriptOperator">?</span> 1 <span class="ActionScriptOperator">:</span> 0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">setValue_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// p1が範囲外
</span>                    <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[(</span><span class="ActionScriptDefault_Text">i_pos1</span>.<span class="ActionScriptDefault_Text">sqDist_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">i_pos2</span>.<span class="ActionScriptDefault_Text">sqDist_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]))</span> <span class="ActionScriptOperator">?</span> 1 <span class="ActionScriptOperator">:</span> 0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">setValue_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// 0ならクリッピングして得られた２点を使う。
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">__temp_l</span>.<span class="ActionScriptDefault_Text">makeLinearWithNormalize_2</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i_pos1</span>, <span class="ActionScriptDefault_Text">i_pos2</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">__temp_l</span>.<span class="ActionScriptDefault_Text">makeSegmentLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">w</span>,<span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">h</span>, <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">traceLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">pt</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">i_edge</span>, <span class="ActionScriptDefault_Text">o_coord</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
