<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ExportCollada.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">exporters</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">Dictionary</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">TriangleMesh3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">renderables</span>.<span class="ActionScriptDefault_Text">Triangle3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">renderables</span>.<span class="ActionScriptDefault_Text">Vertex3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">math</span>.<span class="ActionScriptDefault_Text">Matrix3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">proto</span>.<span class="ActionScriptDefault_Text">MaterialObject3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">BitmapFileMaterial</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">WireframeMaterial</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">MaterialsList</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span>.<span class="ActionScriptDefault_Text">papervision3d</span>.<span class="ActionScriptDefault_Text">objects</span>.<span class="ActionScriptDefault_Text">DisplayObject3D</span>;
    
    <span class="ActionScriptASDoc">/**
     * This class lets you export a DisplayObject3D to the Collada file format (*.dae).
     * &lt;p&gt;&lt;/p&gt;
     * 
     * @author Tim Knip
     */</span> 
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">ExportCollada</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DEFAULT_TEXTURE_DIR</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;.&quot;</span>;
        
        <span class="ActionScriptASDoc">/** Default visuals scene id and name. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VISUAL_SCENE_NAME</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;PapervisionScene&quot;</span>;
        
        <span class="ActionScriptASDoc">/** Number of fraction digits to use for floats. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 5;
        
        <span class="ActionScriptASDoc">/** Boolean indicatin whether to flip faces. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">REVERSE_WINDING</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptASDoc">/**
         * 
         */</span> 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">export</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_hasImages</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">_numImages</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_materialToImageId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_numInstances</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_numMaterials</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptDefault_Text">_materialTargets</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">prepareMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;COLLADA xmlns=&quot;http://www.collada.org/2005/11/COLLADASchema&quot; version=&quot;1.4.1&quot;&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export main asset element
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;asset&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;contributor&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;author&gt;Tim Knip&lt;/author&gt;&apos;</span>, 3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;authoring_tool&gt;Papervision3D - ColladaExport&lt;/authoring_tool&gt;&apos;</span>, 3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;comments&gt;&lt;/comments&gt;&apos;</span>, 3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;source_data&gt;&lt;/source_data&gt;&apos;</span>, 3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/contributor&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;created&gt;2008-05-07T00:05:39Z&lt;/created&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;modified&gt;2008-05-07T00:05:39Z&lt;/modified&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;unit meter=&quot;0.01&quot; name=&quot;centimeter&quot;/&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;up_axis&gt;Y_UP&lt;/up_axis&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/asset&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export textures if needed
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_hasImages</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;library_images&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportImages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/library_images&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;    
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// export materials
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;library_materials&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/library_materials&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export effects
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;library_effects&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportEffects</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/library_effects&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export geometries
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;library_geometries&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportGeometries</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/library_geometries&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export scenegraph
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;library_visual_scenes&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;visual_scene id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">VISUAL_SCENE_NAME</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; name=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">VISUAL_SCENE_NAME</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportVisualScene</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>, 3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/visual_scene&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/library_visual_scenes&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export a default collada-scene
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;scene&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;instance_visual_scene url=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">VISUAL_SCENE_NAME</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; /&gt;&apos;</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/scene&gt;&apos;</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/COLLADA&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports the &lt;color&gt; element.
         * 
         * @param material
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rgba</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">WireframeMaterial</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">material</span>.<span class="ActionScriptDefault_Text">lineColor</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">material</span>.<span class="ActionScriptDefault_Text">fillColor</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">color</span> <span class="ActionScriptOperator">&gt;&gt;</span> 16<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 0<span class="ActionScriptDefault_Text">xff</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 0<span class="ActionScriptDefault_Text">xff</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">g</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">color</span> <span class="ActionScriptOperator">&gt;&gt;</span> 8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;</span> 0<span class="ActionScriptDefault_Text">xff</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 0<span class="ActionScriptDefault_Text">xff</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">color</span> <span class="ActionScriptOperator">&amp;</span> 0<span class="ActionScriptDefault_Text">xff</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 0<span class="ActionScriptDefault_Text">xff</span>;
                
                <span class="ActionScriptDefault_Text">rgba</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">g</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">b</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">)</span>, 1.0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">rgba</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>0.0, 0.0, 0.0, 1.0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;color&gt;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rgba</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;&lt;/color&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports the &lt;effect&gt; elements.
         * 
         * @param object
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportEffects</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialTargets</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialToImageId</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;effect id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-fx&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;profile_COMMON&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;newparam sid=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-surface&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;surface type=&quot;2D&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;init_from&gt;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&lt;/init_from&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;format&gt;A8R8G8B8&lt;/format&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/surface&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/newparam&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span>;    
                    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;newparam sid=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-sampler&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;sampler2D&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;source&gt;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-surface&lt;/source&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;minfilter&gt;LINEAR_MIPMAP_LINEAR&lt;/minfilter&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;magfilter&gt;LINEAR&lt;/magfilter&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/sampler2D&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/newparam&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span>;    
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;technique sid=&quot;common&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;phong&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;emission&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/emission&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;ambient&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/ambient&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;diffuse&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;texture texture=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-sampler&quot; texcoord=&quot;TEX0&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/texture&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/diffuse&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;specular&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/specular&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;shininess&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;float&gt;20.0&lt;/float&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/shininess&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;reflectivity&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;float&gt;20.0&lt;/float&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/reflectivity&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;transparent&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;color&gt;1 1 1 1&lt;/color&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/transparent&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;transparency&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;float&gt;1.0&lt;/float&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/transparency&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/phong&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/technique&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/profile_COMMON&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/effect&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportEffects</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports a &lt;source&gt; element with float data.
         * 
         * @param id
         * @param values
         * @param params
         * @param indent
         * 
         * @return XML String
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportFloatSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">values</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;source id=&quot;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;-array&quot;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">values</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">values</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;&lt;float_array id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">fid</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; count=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cnt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;&lt;/float_array&gt;&apos;</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;technique_common&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptDefault_Text">cnt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cnt</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">stride</span>;
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;accessor source=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">fid</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; count=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">cnt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; stride=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;param name=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; type=&quot;float&quot; /&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/accessor&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/technique_common&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/source&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Export all geometries and child-geometries for a specific DisplayObject3D
         * 
         * @param instance
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportGeometries</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;

            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">TriangleMesh3D</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">TriangleMesh3D</span>, <span class="ActionScriptDefault_Text">getInstanceName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;-geometry&quot;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">instance</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportGeometries</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;    
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports a mesh&apos;s geometry as a Collada &lt;geometry&gt; element.
         * 
         * @param mesh
         * @param id
         * @param indent
         * 
         * @return XML string
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">TriangleMesh3D</span>, <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;geometry id=&quot;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;&quot; name=&quot;&apos;</span><span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Triangle3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vertex3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">trianglesByMaterial</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvindices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;mesh&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">v</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptDefault_Text">vData</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">x</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">vData</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">y</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">vData</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">z</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">))</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">faces</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">tri</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;    
                
                <span class="ActionScriptDefault_Text">materialName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">findMaterialName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">material</span>, <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptBracket/Brace">)</span>;    
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!(</span><span class="ActionScriptDefault_Text">trianglesByMaterial</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">))</span>
                    <span class="ActionScriptDefault_Text">trianglesByMaterial</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">trianglesByMaterial</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;    
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">idx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span>;
                
                <span class="ActionScriptDefault_Text">uvindices</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">tri</span> <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">idx</span>, <span class="ActionScriptDefault_Text">idx</span><span class="ActionScriptOperator">+</span>1, <span class="ActionScriptDefault_Text">idx</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">uv0</span>, <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">uv1</span>, <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">uv2</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>    
            
            <span class="ActionScriptComment">// build uv source-data
</span>            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">uvData</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">u</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FRACTION_DIGITS</span><span class="ActionScriptBracket/Brace">))</span>;
            
            <span class="ActionScriptComment">// export &lt;source&gt; elements for vertices and uvs
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportFloatSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;-positions&quot;</span>, <span class="ActionScriptDefault_Text">vData</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;X&quot;</span>, <span class="ActionScriptString">&quot;Y&quot;</span>, <span class="ActionScriptString">&quot;Z&quot;</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportFloatSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;-texcoords&quot;</span>, <span class="ActionScriptDefault_Text">uvData</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;S&quot;</span>, <span class="ActionScriptString">&quot;T&quot;</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export &lt;vertices&gt; element
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;vertices id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-vertices&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;input semantic=&quot;POSITION&quot; source=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-positions&quot; /&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/vertices&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// export a &lt;triangles&gt; element for each material used by the geometry
</span>            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">materialName</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">trianglesByMaterial</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tris</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trianglesByMaterial</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">tris</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">tri</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">tris</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptBracket/Brace">]</span>;
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvindices</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">tri</span> <span class="ActionScriptBracket/Brace">]</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">REVERSE_WINDING</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span>; 
                        <span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>; 
                        <span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v0</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>; 
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v0</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>;
                        <span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>;
                        <span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vindices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uva</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span>; 
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;triangles material=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; count=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">tris</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;input semantic=&quot;VERTEX&quot; source=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-vertices&quot; offset=&quot;0&quot; /&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;input semantic=&quot;TEXCOORD&quot; source=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-texcoords&quot; offset=&quot;1&quot; set=&quot;0&quot; /&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;p&gt;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">p</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&lt;/p&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/triangles&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// all done
</span>            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/mesh&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/geometry&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports the &lt;image&gt; elements.
         * 
         * @param object
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportImages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">BitmapFileMaterial</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;psdFileTex&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numImages</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">BitmapFileMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">url</span>;
                    <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\\&quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">())</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DEFAULT_TEXTURE_DIR</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;/&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">url</span>;
                    <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\/\//</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;image id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; name=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;init_from&gt;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&lt;/init_from&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/image&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptDefault_Text">_materialToImageId</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">id</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportImages</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports the &lt;material&gt; elements.
         * 
         * @param object
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialTargets</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptBracket/Brace">]</span>;
                 
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;material id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; name=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;instance_effect url=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-fx&quot; /&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/material&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports a &lt;matrix&gt; element.
         * 
         * @param matrix
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix3D</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
                <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n11</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n12</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n13</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n14</span>,
                <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n21</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n22</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n23</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n24</span>,
                <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n31</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n32</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n33</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n34</span>,
                <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n41</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n42</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n43</span>, <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">n44</span>
            <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;matrix&gt;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;&lt;/matrix&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;    
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Exports a &lt;visual_scene&gt; element.
         * 
         * @param object
         * @param indent
         * 
         * @return XML string 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportVisualScene</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>                
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getInstanceName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;node id=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; name=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;    
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportMatrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">transform</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">TriangleMesh3D</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;instance_geometry url=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;-geometry&quot;&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;bind_material&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;technique_common&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialTargets</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;instance_material symbol=&quot;&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; target=&quot;#&apos;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">tgt</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&apos;&quot; /&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 4<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/technique_common&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/bind_material&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/instance_geometry&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">exportVisualScene</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span>, <span class="ActionScriptDefault_Text">indent</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/node&gt;&apos;</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptBracket/Brace">)</span>;    
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">xml</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getInstanceName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">instance</span>.<span class="ActionScriptDefault_Text">name</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 2<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">instance</span>.<span class="ActionScriptDefault_Text">name</span>;
            <span class="ActionScriptDefault_Text">instance</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Node&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_numInstances</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">instance</span>.<span class="ActionScriptDefault_Text">name</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prepareMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MaterialsList</span><span class="ActionScriptBracket/Brace">()</span>;    
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">triangle</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Triangle3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">findMaterialName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">triangle</span>.<span class="ActionScriptDefault_Text">material</span>, <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Material&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_numMaterials</span>;
                        <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">addMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">triangle</span>.<span class="ActionScriptDefault_Text">material</span>, <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_numMaterials</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">[</span> <span class="ActionScriptDefault_Text">materialName</span> <span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">BitmapFileMaterial</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_hasImages</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
    
                <span class="ActionScriptDefault_Text">_materialTargets</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">materialName</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;-target&quot;</span>;    
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">child</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DisplayObject3D</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">prepareMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">child</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * 
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">findMaterialName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">find</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialObject3D</span>, <span class="ActionScriptDefault_Text">list</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialsList</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">list</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span>.<span class="ActionScriptDefault_Text">materialsByName</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">find</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">name</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">printLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">indent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">indent</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">s</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;\t&quot;</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">s</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">str</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;\n&quot;</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_numInstances</span>        <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_numMaterials</span>        <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialTargets</span>        <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_hasImages</span>            <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_numImages</span>            <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialToImageId</span>    <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Dictionary</span>;
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
